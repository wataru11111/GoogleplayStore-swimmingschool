<% disabled_off_dates = Setting.find_by(key: 'disabled_off_days')&.value.to_s %>
<% max_off_date       = Setting.find_by(key: 'available_off_day')&.value %>

<div class="calendar-photo-container">
  <h2>8月スケジュール表</h2>
  <%= image_tag 'august_schedule.png', class: 'calendar-photo', alt: '8月スケジュール' %>
</div>

<div class="calendar-photo-container">
  <h2>9月10月スケジュール表</h2>
  <%= image_tag 'schedule_september_october.png', class: 'calendar-photo', alt: '9月10月スケジュール' %>
</div>

<div class="container">
  <% if flash[:alert].present? %>
    <div class="alert alert-danger"><%= flash[:alert] %></div>
  <% end %>

  <% if @off&.errors&.any? %>
    <div class="error-messages">
      <h2>登録に失敗しました</h2>
      <ul>
        <% @off.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @off, url: offs_path, method: :post do |f| %>
    <div class="field">
      <%= f.label :姓 %><br />
      <%= f.text_field :child_last_name %>
    </div>

    <div class="field">
      <%= f.label :名 %><br />
      <%= f.text_field :child_first_name %>
    </div>

    <div class="field">
      <%= f.label :お休み日付 %><br />
      <!-- ← Flatpickr 用に text_field に変更 -->
      <%= f.text_field :off_month,
            id: "off_month",
            data: {
              disabled_dates: disabled_off_dates,
              mindate: Date.current.to_s,
              maxdate: max_off_date
            },
            autocomplete: "off",
            placeholder: "YYYY-MM-DD" %>
    </div>

    <div class="row">
      <div class="actions"><br>
        <%= f.submit "保存" %>
      </div>
    </div>
  <% end %>
</div>
